<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="scripts/gl.js"></script>
    <script src="scripts/Shader.js"></script>
    <script src="scripts/RenderLoop.js"></script>
    <script>
        let gl;
        let gVerticesCount = 0;
        let uPointSizeLocation = -1;
        let uAngle = 0;
        let gRenderLoop;

        window.addEventListener("load", function () {
            gl = GLInstance("glcanvas").fSetSize(500, 500).fClear();

            // Setup shaders
            let shaderProgram = ShaderUtil.domShaderProgram(gl, "vertexShader", "fragmentShader", true);

            // get location of uniforms and attributes
            gl.useProgram(shaderProgram);
            let aPositionLocation = gl.getAttribLocation(shaderProgram, "aPosition");
            uPointSizeLocation = gl.getUniformLocation(shaderProgram, "uPointSize");
            uAngle = gl.getUniformLocation(shaderProgram, "uAngle");
            gl.useProgram(null);

            //setup data buffers
            let arrayVertices = new Float32Array([0, 0, 0]);
            let bufferVertices = gl.fCreateArrayBuffer(arrayVertices);

            gVerticesCount = arrayVertices.length / 3

            //setup for drawing
            gl.useProgram(shaderProgram);

            gl.bindBuffer(gl.ARRAY_BUFFER, bufferVertices);
            gl.enableVertexAttribArray(aPositionLocation);
            gl.vertexAttribPointer(aPositionLocation, 3, gl.FLOAT, false, 0, 0);
            gl.bindBuffer(gl.ARRAY_BUFFER, null);

            gRenderLoop = new RenderLoop(onRender, 30.0).start();
        });

        let gPointSize = 0;
        let gPointSizeStep = 3;
        let gAngle = 0;
        let gAngleStep = (Math.PI / 180.0) * 90;


        function onRender(deltaTime) {
            gPointSize += gPointSizeStep * deltaTime;
            let size = (Math.sin(gPointSize) * 20.0) + 30.0;
            gl.uniform1f(uPointSizeLocation, size);

            gAngle += gAngleStep * deltaTime;
            gl.uniform1f(uAngle, gAngle);

            gl.fClear();
            gl.drawArrays(gl.POINTS, 0, gVerticesCount);
        }
    </script>
    <link rel="stylesheet" href="style.css">

</head>
[
<body>

<div>
    <canvas id="glcanvas"></canvas>
</div>

<script id="vertexShader" type="x-shader/x-vertex">#version 300 es
in vec3 aPosition;

uniform mediump float uPointSize;
uniform float uAngle;

out vec3 size;

void main(void){
    gl_PointSize = uPointSize;
    size = vec3(uPointSize);
    gl_Position = vec4(cos(uAngle) * 0.8 + aPosition.x, sin(uAngle) * 0.8 + aPosition.y, aPosition.z, 1.0);
}
</script>


<script id="fragmentShader" type="x-shader/x-fragment">#version 300 es
precision mediump float;

uniform mediump float uPointSize;
in vec3 size;
out vec4 finalColour;

void main(void){
    float colour = (40.0 - uPointSize )/ 20.0;
    finalColour = vec4(colour, colour, colour, 1.0);
}
</script>

</body>
</html>